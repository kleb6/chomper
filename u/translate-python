#!/usr/bin/env raku
use python-grammar;
use Data::Dump::Tree;
use Data::Dump;
use JSON::Class;
use python-to-rust-actions;

class A does Python3::ToRustActions {}

grammar G does Python3 { }

use Grammar::Tracer;
grammar GD does Python3 { }

sub MAIN(Bool :$debug = False, :$rule = Nil, :$to-rust = True) {

    my $in = $*IN.slurp;

    my %kwargs = %();

    if $rule { 
        %kwargs<rule> = $rule; 
        $in = $in.chomp; 
    }

    if $to-rust { 
        %kwargs<actions> = A.new 
    }

    my $parsed = G.parse($in, |%kwargs) // GD.parse($in, |%kwargs);

    if $to-rust {
        for $parsed.made {
            if $_ ~~ Python3::Classdef {
                say $_.translate-to-rust;
            } else {
                say $_;
            }
        }

    } else {
        say $parsed;
    }
}
